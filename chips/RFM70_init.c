/*
 * RFM70_init.c
 * Copyright (C) 2014 Krystian Dużyński <krystian.duzynski@gmail.com>
 */

#include "RFM70.h"

/*
Data bits: MSB bit in each byte first
Data Bytes LSB first: Bank0 and Bank1_Reg9 to Bank1_Reg14
Data Bytes MSB first: Bank1_Reg0 to Bank1_Reg8
*/
const uint8_t Bank1_Reg0_13[][4] =
{
	{ 0x40, 0x4B, 0x01, 0xE2 },
	{ 0xC0, 0x4B, 0x00, 0x00 },
	{ 0xD0, 0xFC, 0x8C, 0x02 },
	{ 0x99, 0x00, 0x39, 0x41 },
	{ 0xD9, 0x9E, 0x86, 0x0B },
	// { 0x24, 0x06, 0x7F, 0xA6 },
	{ 0x24 & ~(15 << (26 - 24)), 0x06 & ~(1 << (18 - 16)), 0x7F, 0xA6},
	{ 0x00, 0x00, 0x00, 0x00 },
	{ 0x00, 0x00, 0x00, 0x00 },
	{ 0x00, 0x00, 0x00, 0x00 }, // reversed till this!
	{ 0x00, 0x00, 0x00, 0x00 },
	{ 0x00, 0x00, 0x00, 0x00 },
	{ 0x00, 0x00, 0x00, 0x00 },
	{ 0x00, 0x12, 0x73, 0x00 },
	{ 0x36, 0xB4, 0x80, 0x00 }  // 0x0d
};
const uint8_t Bank1_Reg14[] =
{
	0x41, 0x20, 0x08, 0x04, 0x81, 0x20, 0xCF, 0xF7, 0xFE, 0xFF, 0xFF
};

uint8_t rfm70InitRegisters()
{
	uint8_t i, j, val;
	uint8_t buf[11];
	
	RFM70_ER(rfm70SetBank(1));
	for (i = 0; i <= 0x0d; i++)
	{
		for (j = 0; j < 4; j++)
			buf[j] = Bank1_Reg0_13[i][j];
		RFM70_ER(rfm70WriteRegister(i, buf, 4));
	}
	for (j = 0; j < 11; j++)
		buf[j] = Bank1_Reg14[j];
	RFM70_ER(rfm70WriteRegister(0x0e, buf, 11));
	
	RFM70_ER(rfm70SetBank(0));
	return RFM70_SUCCESS;
}
